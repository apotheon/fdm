17 March 2007

* Don't bother passing mail to parent if the user doesn't actually need to be
  changed. 

16 March 2007

* Change so that the child uses poll(2) on all the fds rather than letting
  the fetch-* stuff poll and periodically checking the parent fd.
* Make delivery children be handled in the main loop (fdm.c) along with
  the fetch children. This means that different accounts will not block each
  other when delivering. I tried allowing multiple simultaneous deliveries
  for each account but it doesn't work very well, particularly regarding
  errors.

15 March 2007

* Seriously reduce -v output in favour of -vv and -vvv.
* Save mail in a queue as it is fetched and perform matching/delivery on it
  while waiting for the server to send the next mail. This can give a 20-50%
  speed increase with some rulesets, particularly with slow POP3 servers.

13 March 2007

* Don't pass stdin to poll(3) instead of closed sockets. Fixes problems with
  rewrite and empty mails on Linux. Reported & tested by Frank Terbeck.

12 March 2007

* The timeout setting is now used for commands too.
* Expand leading ~s into home directories where appropriate.
* Section headings are now numbered in MANUAL.

11 March 2007

* You can't use a va_list twice even when it's passed in as an argument. Duh.
  Fixes segfaults on PPC. Reported by Daniel Wilmer.

08 March 2007

* Try to introduce some consistency into tag replacement in strings. Introduce
  a new type (struct replstr) which indicates a string that should be replaced
  before use, and try to make sure replacement happens possibly for all strings
  where replacement should happen on parse. Hopefully this will make it easier
  to handle replacement properly in future too.

07 March 2007

* Handle POLLHUP properly in io.c: if it is set and POLLIN isn't set, the 
  fd has closed. This makes stdin delivery work properly on Linux 2.4.

06 March 2007

* Submatches with commands are now added as tags command0 to command9.
* pipe actions now use the command.c framework, which means their stderr is
  logged and stdout discarded.
* mail_file tag added by maildir delivery and mbox_file by mbox. Also pass the
  tags block up and down between parent and child so these tags actually stick.
* A new exec action, similar to pipe but stdin is /dev/null. This is useful
  in combination with the mail_file and mbox_file tags.

04 March 2007

* Bug fix: fill in the correct size for maildir fetched mail rather than using
  the rounded-up size and adding a ton of nulls.
* -D on the command line overrides macro definitions in the configuration file.
* Build the attachment list when the first attachment match rule is found rather
  than for every mail regardless.
* Add a message_id tag to each mail.

03 March 2007

* add-header action and lines, body_lines, header_lines tags for IMAP/POP3,
  suggested by Frank Terbeck.
* Linux dirname(3)/basename(3) screws up the buffer. Fixed it thanks to Frank
  Terbeck.
* Fixed bugs in string parsing thanks to Frank Terbeck.

02 March 2007

* Made add_tag use varargs and added a server_uid tag to POP3/IMAP messages.
* Added infrastructure to maintain a cache of variable-length strings within a
  single contiguous block of data (strb.c), so it can be passed easily up
  to the parent process. Use this for storing mail tags to get rid of the
  arbitrary tag length limits.

28 February 2007

* Man page cleanups, from Tamas TEVESZ.

27 February 2007

* fdm 1.0 released.

22 February 2007

* Fixed silly typo in NNTP code check. SF bug 1650701.
* Included account name in received header.
* Added stdout delivery.
* New append-string delivery to add data to a mail.

19 February 2007

* Added a remove-header action to remove all instances of a header. Based on a
  a request by Tobias Ulmer.

09 February 2007

* Reworked the substitution stuff. Each mail now carries a list of tag name,
  value pairs, some of which are autogenerated (account, action, etc) and others
  which may be added by the user. They may be inserted in strings using %[name].
  The autogenerated tags are aliased to the old single letter tokens. Based on
  a question from AJ Weber.
* Added a timeout option to limit the time for which servers are waited.

08 February 2007

* Added file-umask and file-group options to control permissions and group
  ownership of created mboxes and maildirs. Altered the permissions checks
  to take this into account, and extended them to maildirs. Suggestion from
  AJ Weber.
* Made mbox/maildir creation clearer in documentation.

07 February 2007

* Added -D command line option to define a macro.

05 February 2007

* Made options be printed with -v. 

27 January 2007

* Fixed attachment parsing so that it works as intended.

26 January 2007

* Started a changelog.
* Assigned a number to each rule and changed logging to refer to it. Also
  tweaked the -vv configuration file output.
* Changed some vasprintf to xvasprintf now that the latter exists.
* Fixed command.c to trim CR line end if present, this makes IMAP over ssh
  work. (0.9a)
* Fixed miscalculation of length in find_header. (0.9a)
* Fixed find_header to locate the first rather than second instance.
* Added FQDN and what it resolves to to the domains list by default.
* Added a basic Received header with local host and fdm version, may be disabled
  with the new set no-received option.
* Free mmap'd region before mmap'ing it again in shm_realloc, otherwise the
  actual disk space isn't freed. This affected previous versions too but 
  the mail was very rarely reallocated, now that the header is added it is.
* Changed all the descriptions to static buffers and audited use of snprintf.

$Id: CHANGES,v 1.42 2007-03-17 13:50:37 nicm Exp $
