<!-- $Id: index.html,v 1.19 2006-12-04 14:29:37 nicm Exp $ -->
<html>
<head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<title>fdm</title>
</head>
<body>
<p>The project page is <a href="http://sf.net/projects/fdm">here.</a></p>
<PRE>
FDM(1)                     OpenBSD Reference Manual                     FDM(1)

<B>NAME</B>
     <B>fdm </B>- fetch and deliver mail

<B>SYNOPSIS</B>
     <B>fdm </B>[<B>-klmnv</B>] [<B>-f </B><I>conffile</I>] [<B>-u </B><I>user</I>] [<B>-a </B><I>account</I>] [<B>-x </B><I>account</I>] [<I>fetch </I>|
         <I>poll</I>]

<B>DESCRIPTION</B>
     The <B>fdm </B>program fetches mail from a POP3 or IMAP server or from <I>stdin </I>and
     delivers it based on a ruleset in the configuration file.

     The options are as follows:

     <B>-a </B><I>name         </I>Process only the specified account. This option may ap-
                     pear multiple times. The account name may include shell
                     glob characters to match multiple accounts.

     <B>-f </B><I>conffile     </I>Specify the configuration file location. Default is
                     <I>~/fdm.conf</I>, or <I>/etc/fdm.conf </I>if that doesn't exist.

     <B>-k              </B>Keep all mail after delivery, regardless of whether it
                     matches a <B>drop </B>action. Note that mails kept in this way
                     will be refetched by <B>fdm </B>if it is run again on the same
                     account.

     <B>-l              </B>Log using syslog(3) rather than to <I>stderr</I>.

     <B>-m              </B>Ignore the lock file and run regardless of other in-
                     stances of <B>fdm</B>.

     <B>-n              </B>Do not process any accounts, just verify the configura-
                     tion file syntax and exit.

     <B>-u </B><I>user         </I>Specify the default user for delivery. This overrides the
                     <B>default-user </B>option in the configuration file.

     <B>-v              </B>Request verbose logging. This option may be specified
                     multiple times.  <B>-vv </B>will print information on configura-
                     tion (useful with <B>-n</B>).  <B>-vvvv </B>duplicates all traffic to
                     and from remote servers to <I>stdout</I>, but note that this
                     feature is disabled when using the <B>-l </B>flag.

     <B>-x </B><I>name         </I>Exclude the named account. Multiple <B>-x </B>options may be
                     specified. As with <B>-a</B>, shell glob characters may be used.

     <I>fetch </I>| <I>poll    </I>The <I>fetch </I>command instructs <B>fdm </B>to fetch and deliver mes-
                     sages. The <I>poll </I>command polls the accounts in the config-
                     uration file and reports a message count for each.

<B>LOCAL MAIL WITH SENDMAIL</B>
     <B>fdm </B>can be used to deliver local mail from sendmail(8) by making use of
     .forward files. An account fetching mail from <I>stdin </I>should be specified
     in the user's <I>~/.fdm.conf </I>file,

           account "stdinacct" stdin

     and the user's <I>~/.forward </I>file should be set to contain something like
     (including quotation marks):

           "|/usr/local/bin/fdm -ml -a stdinacct fetch"

     sendmail(8) will then invoke <B>fdm </B>to deliver mail and <B>fdm </B>will pass it
     through any filtering rules as normal.

<B>FILES</B>
     ~/.fdm.conf          default <B>fdm </B>configuration file
     /etc/fdm.conf        default system-wide configuration file
     ~/.fdm.lock          default lock file
     /var/db/fdm.lock     lock file for root user

<B>SEE ALSO</B>
     mail(1), fdm.conf(5), sendmail(8)

<B>AUTHORS</B>
     Nicholas Marriott &lt;nicm@users.sourceforge.net&gt;

OpenBSD 4.0                     August 14, 2006                              2
</PRE>
<PRE>
FDM.CONF(5)               OpenBSD Programmer's Manual              FDM.CONF(5)

<B>NAME</B>
     <B>fdm.conf </B>- fdm configuration file

<B>DESCRIPTION</B>
     This manual page describes the fdm(1) configuration file.  It defines
     <I>accounts </I>from which to fetch mail, a number of possible <I>actions </I>to take,
     and <I>rules </I>connecting a regexp with an action.  The file is parsed once
     from top to bottom, so action and account definitions must appear before
     they are referenced in a rule.  Rules are evaluated from first to last
     and (unless overridden by the <B>continue </B>keyword) evaluation stops at the
     first match.

     The file has the following format:

     Empty lines and lines beginning with the `#' character are ignored.

     Regexps and strings must be enclosed in double quotes.  Special charac-
     ters in regexps and strings (including passwords) must be escaped.  Note
     that this may mean double-escaping in regexps.

     Possible commands are covered in the following sections.

<B>OPTIONS</B>
     Options are configured using the <B>set </B>command.  It may be followed by the
     following options, one per command:

     <B>maximum-size </B><I>size</I>
             This is used to set the maximum size of a mail.  Mails larger
             than this limit are dropped and, if applicable, not deleted from
             the server.

             The size may be specified as a plain number in bytes or with a
             suffix of `K' for kilobytes, `M' for megabytes or `G' for giga-
             bytes.  The default is one gigabyte.

     <B>delete-oversized</B>
             If this option is specified, fdm(1) attempts to delete messages
             which exceed <B>maximum-size</B>, and continue.  If it is not specified,
             oversize messages are a fatal error and cause fdm(1) to abort.

     <B>allow-multiple</B>
             If this option is specified, fdm(1) does not attempt to create a
             lock file and allows multiple instances to run simultaneously.

     <B>lock-file </B><I>path</I>
             This sets an alternative lock file. The default is <I>~/.fdm.lock</I>
             for non-root users and <I>/var/db/fdm.lock </I>for root.

     <B>default-user </B><I>user</I>
             This sets the default user to change to before delivering mail,
             if fdm(1) is running as root and no alternative user is specified
             as part of the action or rule.  This option may be overridden
             with the <B>-u </B>switch on the command line.  A default user must be
             given if running as root.

     <B>lock-types </B><I>type ...</I>
             This specifies the locks to be used for mbox locking.  Possible
             types are <I>fcntl</I>, <I>flock</I>, and <I>dotlock</I>.  The <I>flock </I>and <I>fcntl </I>types
             are mutually exclusive.  The default is <I>flock</I>.

     <B>domain </B><I>domain </I>| <B>domains </B>{ <I>domain ... </I>}
             This specifies the domains to be used when looking for users with
             the <B>from-headers </B>keyword.  The default is the computer's host-
             name.

     <B>header </B><I>header </I>| <B>headers </B>{ <I>header ... </I>}
             This allows the headers to be examined when looking for users to
             be set.  The default is to look only at the "From" and "Cc" head-
             ers.  The headers are case-insensitive.

     <B>proxy </B><I>url</I>
             This instructs fdm(1) to proxy all connections through <I>url</I>.  HTTP
             and SOCKS5 proxies are supported at present (URLs of the form
             <I>http://host[:port] or socks://[user:pass@]host[:port])</I>.  No au-
             thentication is supported for HTTP.  This option may be overrid-
             den by an <I>http_proxy </I>variable in the environment.

     <B>unmatched-mail </B><I>drop </I>| <I>keep</I>
             This option controls what fdm(1) does with mail that reaches the
             end of the ruleset (mail that matches no rules or matches only
             rules with the <B>continue </B>keyword).  <I>drop </I>will cause such mail to
             be discarded, and <I>keep </I>will attempt to leave the mail on the
             server.  The default is to keep the mail and log a warning that
             it reached the end of the ruleset.

<B>INCLUDING FILES</B>
     Further configuration files may be including using the <B>include </B>command:

     <B>include </B><I>path</I>

     The file to include is searched for first as an absolute path and then
     relative to the directory containing the main configuration file.

<B>MACROS</B>
     Macros may be defined using the following syntax:

     <I>$name <B></I>= </B><I>string</I>

     <I>%name <B></I>= </B><I>number</I>

     Macros are prefixed with $ to indicate a string value and % to indicate a
     numeric value.  Once defined, a macro may be used in any place a string
     or number is expected. Macros may be embedded in strings by surrounding
     their name (after the $ or %) with {}s, like so:

           "abc ${mymacro} %{anothermacro} def"

<B>ACCOUNTS</B>
     The <B>account </B>command is used to instruct fdm(1) to fetch mail from an ac-
     count.  The syntax is:

     <B>account </B><I>name </I>[<B>disabled</B>] <I>type </I>[<I>args</I>] [<B>keep</B>]

     The <I>name </I>argument is a string specifying a name for the account.  The
     <B>disabled </B>keyword instructs fdm(1) to ignore this account unless it is ex-
     plicitly enabled with a <B>-a </B>option on the command line.  If the <B>keep </B>key-
     word is specified, all mail collected from this account is kept (not
     deleted) even if it matches a <B>drop </B>action.

     Supported account types and arguments are:

     <B>stdin   </B>This account type reads mail from <I>stdin</I>, if it is connected to a
             pipe.  This may be used to deliver mail from sendmail(8), see
             fdm(1) for details.

     <B>pop3 server </B><I>host </I>[<B>port </B><I>port</I>] <B>user </B><I>user <B></I>pass </B><I>pass</I>

     <B>pop3s server </B><I>host </I>[<B>port </B><I>port</I>] <B>user </B><I>user <B></I>pass </B><I>pass</I>
             These statements define a POP3 or POP3S account.  The <I>host</I>, <I>user</I>
             and <I>pass </I>arguments must be strings.  The port option may be ei-
             ther a string which will be looked up in the services(5)
             database, or a number.  If it is omitted, the default port (143
             for POP3, 993 for POP3S) is used.

     <B>imap server </B><I>host </I>[<B>port </B><I>port</I>] <B>user </B><I>user <B></I>pass </B><I>pass </I>[<B>folder </B><I>name</I>]

     <B>imaps server </B><I>host </I>[<B>port </B><I>port</I>] <B>user </B><I>user <B></I>pass </B><I>pass </I>[<B>folder </B><I>name</I>]
             These define an IMAP or IMAPS account.  The parameters are as for
             a POP3 or POP3 account, aside from the additional <B>folder </B>option
             which allows the folder name to be specified (the default is to
             fetch from the inbox).

     <B>maildir </B><I>path</I>

     <B>maildirs </B>{ <I>path ... </I>}
             These account types instruct fdm(1) to fetch mail from the
             maildir or maildirs specified.  This allows fdm(1) to be used to
             filter mail, fetching from a maildir and deleting (dropping) un-
             wanted mail, or delivering mail to another maildir or to an mbox.

<B>ACTIONS</B>
     The <B>action </B>command is used to define actions.  These may be specified by
     name in rules (see below) to perform some action on a mail.  The syntax
     is:

     <B>action </B><I>name </I>[<I>users</I>] <I>action</I>

     The <I>name </I>is a string defining a name for the action.  The optional <I>users</I>
     argument has the following form:

     <B>user </B><I>user </I>| <B>users </B>{ <I>user ... </I>} | <B>user from-headers</B>

     The first two options specify a user or list of users as which the mail
     should be delivered.  If <B>user from-headers </B>is specified, fdm(1) attempts
     to find the users from the mail headers, using the values of the <B>headers</B>
     and <B>domains </B>options.  If no headers are specified, or fdm(1) fails to
     find any valid users in the headers, the default user (set with <B>set</B>
     <B>default-user</B>) is used.  An action's user setting may be overridden in the
     matching rule.  This keyword has no effect if fdm(1) is run as non-root.

     The possible values for <I>action </I>are listed below.  In actions for which a
     <I>command </I>or <I>path </I>is specified, the following substitutions are made before
     it is used: <I>%a </I>is replaced by the account name, <I>%h </I>by the current user's
     home directory, <I>%t </I>by the name of the current action, <I>%u </I>by the current
     user's login name, <I>%n </I>by the UID and <I>%H </I>by the current hour (00-23), <I>%M</I>
     minute (00-59), <I>%S </I>second (00-59), <I>%d </I>day of the month (00-31), <I>%m </I>month
     (01-12), <I>%y </I>year, <I>%W </I>day of the week (0-6, Sunday is 0), <I>%Y </I>day of the
     year (000-365) and <I>%Q </I>quarter (1-4).  In addition, <I>%s </I>is replaced by a
     string specific to the type of account.  When fetching from a maildir,
     this is the basename of the maildir path.  With pop3 or imap, it is the
     hostname of the server, as specified in the account definition.

     <B>drop    </B>Discard the mail.

     <B>keep    </B>Keep the mail, do not remove it from the account.

     <B>maildir </B><I>path</I>
             Save the mail to the maildir specified by <I>path</I>.

     <B>mbox </B><I>path</I>
             Append the mail to the mbox at <I>path</I>.

     <B>pipe </B><I>command</I>
             Pipe the entire mail to <I>command</I>.

     <B>write </B><I>path</I>
             Write the mail to <I>path</I>.

     <B>append </B><I>path</I>
             Append the mail to <I>path</I>.

     <B>smtp server </B><I>host </I>[<B>port </B><I>port</I>] [<B>to </B><I>to</I>]
             Connect to an SMTP server and attempt to deliver the mail to it.
             If <I>to </I>is specified, it is passed to the server in the RCPT TO
             command.  If not, the current user and host names are used.

     <B>rewrite </B><I>command</I>
             Pipe the entire mail through <I>command </I>to generate a new mail and
             use that mail for any following actions or rules.  An example of
             the <B>rewrite </B>action is:

                   action "cat" pipe "cat"
                   action "rewrite" rewrite "sed 's/bob/fred/g'"
                   # this rule will rewrite the message
                   match all action "rewrite" continue
                   # this rule will cat the rewritten message
                   match all action "cat"

<B>RULES</B>
     Rules are specified using the <B>match </B>keyword.  It has one of the following
     basic forms:

     <B>match </B><I>condition </I>[<B>and </B>| <B>or </B><I>condition ...</I>] [<I>accounts</I>] [<I>users</I>] <I>actions</I>
             [<B>continue</B>]

     <B>match </B><I>condition </I>[<B>and </B>| <B>or </B><I>condition ...</I>] [<I>accounts</I>] <B>tag </B><I>string</I>

     The <I>condition </I>argument may be one of:

     <B>all     </B>Matches all mail.

     [<B>not</B>] <B>matched</B>
             Matches only mail that has matched a previous rule and been
             passed on with <B>continue</B>.

     [<B>not</B>] <B>unmatched</B>
             The opposite of <B>matched</B>: matches only mails which have matched no
             previous rules.

     [<B>not</B>] <B>tagged </B><I>string</I>
             Matches mails tagged with <I>string</I>.

     [<B>not</B>] [<B>case</B>] <I>regexp </I>[<B>in headers </B>| <B>in body</B>]
             Specifies a list of regexps against which each mail should be
             matched.  The regexp matches may be restricted to either the
             headers or body of the message by specifying either <B>in headers </B>or
             <B>in body</B>.  The <B>case </B>keyword forces the regexp to be matched case-
             sensitively: the default is case-insensitive matching.

     [<B>not</B>] <B>exec </B><I>command <B></I>returns </B>(<I>return code</I>, <I>stdout regexp</I>)

     [<B>not</B>] <B>pipe </B><I>command <B></I>returns </B>(<I>return code</I>, <I>stdout regexp</I>)
             These two conditions execute a <I>command </I>and test its return value
             and output. The <I>return code </I>argument is the numeric return code
             expected and <I>stdout regexp </I>is a regexp to be tested against the
             output of the command to <I>stdout</I>.  Either of these two arguments
             may be omitted: if both are specified, both must match for the
             condition to be true.  The <B>pipe </B>version will pipe the mail to the
             command's <I>stdin </I>when executing it.

     [<B>not</B>] <B>size </B>&lt; <I>number</I>

     [<B>not</B>] <B>size </B>&gt; <I>number</I>
             Compare the mail size with <I>number</I>.

     [<B>not</B>] <B>string </B><I>string <B></I>to </B><I>regexp</I>
             Match <I>string </I>against <I>regexp</I>.  If any of %0 to %9 appear in the
             string, they will be replaced with the contents of any subexpres-
             sions from the regexp executed as part of the last <B>regexp </B>condi-
             tion. If no <B>regexp </B>condition has yet been seen, or the mail con-
             tents has been modified by a <B>rewrite </B>action since the last one,
             this condition will log a warning and evaluate to false.

     [<B>not</B>] <B>age </B>&lt; <I>time</I>

     [<B>not</B>] <B>age </B>&gt; <I>time</I>
             The <B>age </B>condition examines the mail's date header to determine
             its age, and matches if the mail is older (&lt;) or newer (&gt;) than
             the time specified.  The time may be given as a simple number in
             seconds, or followed by the word <I>seconds</I>, <I>hours</I>, <I>minutes</I>, <I>days</I>,
             <I>months </I>or <I>years </I>to specify a time in different units.

     Aside from the <B>all </B>condition, multiple conditions may be chained together
     using the <B>and </B>or <B>or </B>keywords.  The conditions are tested from left to
     right.  The <B>not </B>keyword may be specified to invert the sense of a condi-
     tion.

     The first form of the command specifies a number of actions to take when
     a mail matches the rule.  The second form tags the mail with <I>string</I>,
     which may be matched using the <B>tagged </B>condition in later rules. A mail
     may be tagged with any number of different strings by different rules.
     Rules which apply a tag do not count as a match for the purposes of the
     <B>matched </B>or <B>unmatched </B>conditions.

     The optional <I>users </I>argument to the first form has the same syntax as for
     an <B>action </B>definition.  A rule's user list overrides any users given as
     part of the actions.

     Both the <I>accounts </I>and <I>actions </I>parts consist either of a single name or a
     list of names enclosed in braces:

     <B>account </B><I>name </I>| <B>accounts </B>{ <I>name ... </I>}

     <B>action </B><I>name </I>| <B>actions </B>{ <I>name ... </I>}

     The <I>accounts </I>list is used to limit rules to matching mail within a set of
     accounts, and the <I>actions </I>list specifies the actions to perform when the
     rule matches a mail.  The account names may include shell glob wildcards
     to match multiple accounts, as with the <B>-a </B>and <B>-x </B>command line options.
     The actions are performed from left to right in the order they are speci-
     fied in the rule definition.

     If the <B>continue </B>keyword is present, evaluation will not stop if this rule
     is matched.  Instead, fdm(1) will continue to match further rules after
     performing any actions for this rule.

<B>NESTED RULES</B>
     Rules may be nested by specifying further rules in braces:

     <B>match </B><I>condition </I>[<B>and </B>| <B>or </B><I>condition ...</I>] {

     <B>match </B><I>...</I>

     }

     The inner rules will not be evaluated unless the outer one matches. Rules
     may be multiply nested. Note that the outer rule does not count as a
     match for the purposes of the <B>matched </B>and <B>unmatched </B>conditions.

<B>FILES</B>
     ~/.fdm.conf          default <B>fdm.conf </B>configuration file
     /etc/fdm.conf        default system-wide configuration file
     ~/.fdm.lock          default lock file
     /var/db/fdm.lock     lock file for root user

<B>SEE ALSO</B>
     fdm(1), re_format(7)

<B>AUTHORS</B>
     Nicholas Marriott &lt;nicm@users.sourceforge.net&gt;

OpenBSD 4.0                     August 21, 2006                              6
</PRE>
</body>
</html>
