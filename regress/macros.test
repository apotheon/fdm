# $Id: macros.test,v 1.2 2006-11-30 21:56:25 nicm Exp $

%macro = 0
@0

%macro = 9223372036854775808
@1 ^/dev/stdin: number is too large at line 1$

%macro = 9223372036854775807
@0

$macro = ""
@0

# ------------------------------------------------------------------------------
# UNDEFINED

account $macro stdin
@1 ^/dev/stdin: undefined macro: \$macro at line 1$
account %macro stdin
@1 ^/dev/stdin: syntax error at line 1$

set maximum-size %macro
@1 ^/dev/stdin: undefined macro: %macro at line 1$

account "${macro}" stdin
@1 ^/dev/stdin: undefined macro: \$macro at line 1$
account "a${macro}" stdin
@1 ^/dev/stdin: undefined macro: \$macro at line 1$
account "${macro}b" stdin
@1 ^/dev/stdin: undefined macro: \$macro at line 1$
account "a${macro}b" stdin
@1 ^/dev/stdin: undefined macro: \$macro at line 1$

account "%{macro}" stdin
@1 ^/dev/stdin: undefined macro: %macro at line 1$
account "a%{macro}" stdin
@1 ^/dev/stdin: undefined macro: %macro at line 1$
account "%{macro}b" stdin
@1 ^/dev/stdin: undefined macro: %macro at line 1$
account "a%{macro}b" stdin
@1 ^/dev/stdin: undefined macro: %macro at line 1$

# ------------------------------------------------------------------------------
# DEFINED

!%macro = 1000
!$macro = "one"

account $macro stdin
@0 ^added account: name=one fetch=stdin$
account %macro stdin
@1 ^/dev/stdin: syntax error at line 3$

set maximum-size %macro
@0

account "${macro}" stdin
@0 ^added account: name=one fetch=stdin$
account "a${macro}" stdin
@0 ^added account: name=aone fetch=stdin$
account "${macro}b" stdin
@0 ^added account: name=oneb fetch=stdin$
account "a${macro}b" stdin
@0 ^added account: name=aoneb fetch=stdin$

account "%{macro}" stdin
@0 ^added account: name=1000 fetch=stdin$
account "a%{macro}" stdin
@0 ^added account: name=a1000 fetch=stdin$
account "%{macro}b" stdin
@0 ^added account: name=1000b fetch=stdin$
account "a%{macro}b" stdin
@0 ^added account: name=a1000b fetch=stdin$

# ------------------------------------------------------------------------------
# REPLACEMENT

$macro = "two"
@0

%macro = 2000
@0
